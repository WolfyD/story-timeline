<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Story Timeline</title>
    <link rel="stylesheet" href="main.css" type="text/css" />
    <link rel="stylesheet" href="timeline.css" type="text/css" />
    <link rel="stylesheet" href="modal.css" type="text/css" />
    <link rel="stylesheet" href="menubar.css" type="text/css" />
    <link rel="stylesheet" href="styles.css" type="text/css" />
    <link rel="stylesheet" href="node_modules/remixicon/fonts/remixicon.css" type="text/css" />
  </head>
  <body>
    <div id="calligraphy_container" style="display: none;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260.481 370" xml:space="preserve" width="260.481" height="370">
        <g transform="translate(1019.784 428.97)"/>
        <g style="font-size:388.889px;line-height:1.25;font-family:Arial;-inkscape-font-specification:&quot;Arial, Normal&quot;;fill:#000;fill-opacity:1;stroke:#010101;stroke-width:1.25561;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1">
          <path d="M25.457 355.248c11.465-9.44 30.713-7.155 47.235-7.155q32.876 0 59.176 24.783l49.567-49.566-8.093-9.104-18.208 17.702q-29.841-17.702-63.728-17.702l19.725-55.636h109.755l20.737 69.798q9.61 33.887 29.84 44.508l50.073-49.566-8.092-9.104-18.209 18.208q-10.115-4.047-14.667-12.139-1.012-2.023-3.035-6.575-1.517-4.552-3.54-11.633l-66.258-220.52q-9.104-30.347-15.173-38.945l4.552-14.668-11.127-4.552-4.552 10.621q-15.68-11.127-33.382-11.127-26.3 0-47.037 18.714-7.08 5.564-15.174 15.68-7.586 10.115-17.196 24.277l9.61 6.575q21.243-30.852 48.049-30.853 22.76 0 37.933 21.749l-19.725 51.59q-9.61-.506-14.668-.506-5.058-.506-6.07-.506-38.438 0-38.438 44.003 0 13.656 6.069 29.335l11.127-5.058q-2.529-7.587-2.529-11.633 0-23.266 20.231-23.266 6.576 0 11.633 5.058l-53.612 146.17q-34.393 4.047-57.153 26.807zm183.29-135.117h-82.948l45.52-124.928Z" style="font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-family:&quot;Olde English&quot;;-inkscape-font-specification:&quot;Olde English&quot;;fill:#000;fill-opacity:1;stroke:#010101;stroke-width:1.25561;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" transform="matrix(.79627 0 0 .79658 -6.237 -6.723)" aria-label="A"/>
        </g>
      </svg>      
    </div>
    <button class="settings-button open-settings-button no-select" onclick="openSettings()">Settings</button>
    <div id="version-display" class="version-display no-select">v0.2.1</div>
    <div id="fps_display" class="fps-display no-select">FPS: 0</div>
    <div id="visible_item_counter" class="visible-item-display no-select">Items visible: 0</div>

    <!-- Global hover bubble -->
    <div id="global-hover-bubble" class="global-hover-bubble no-select"></div>

    <!-- Header Area -->
    <div class="title-container">
      <h1 id="main_title" class="main_title no-select">Story Name</h1>
      <h2 id="main_subtitle" class="main_subtitle no-select">Story Timeline</h2>
    </div>

    <!-- Main Content Areas -->
    <div class="main-content-left">
      <!-- Left column content -->
      <div id="image-container" class="image-container">
        <!-- Images will be dynamically added here -->
      </div>
    </div>

    <div class="main-content-middle">
      <!-- Middle column content -->
    </div>

    <div class="main-content-right">
      <!-- Right column content -->
    </div>

    <!-- Timeline Area -->
    <div class="timeline_container" id="timeline-container">
      <div id="timeline"></div>
      <div id="arrow"></div>
      <div id="now-marker">Now</div>
      <div id="center-line"></div>
      <div id="h-rule"></div>
      <div id="timeline-hover-marker"></div>
      <div id="timeline-hover-marker-stick"></div>
    </div>

    <!-- Settings -->
    <div class="settings_container">
      <div class="settings_div"> <button class="settings-button close_settings-button no-select" onclick="closeSettings()">X</button>
        <h1 class="no-select">Settings</h1>
        <div class="font-selector">
          <label for="font-select no-select">Default Font:</label>
          <div class="font-selector-container">
            <select id="font-select" onmousewheel="handleFontMouseWheel()" onchange="handleFontChange(this.value)">
              <optgroup label="Default fonts">
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Arial">Arial</option>
                <option value="Courier New">Courier New</option>
                <option value="Verdana">Verdana</option>
                <option value="Tahoma">Tahoma</option>
                <option value="Trebuchet MS">Trebuchet MS</option>
                <option value="Palatino">Palatino</option>
              </optgroup>
              <optgroup label="Custom fonts">
                <option value="Homemade Apple">Homemade Apple</option>
                <option value="Delicious Handrawn">Delicious Handrawn</option>
                <option value="Borel">Borel</option>
                <option value="Quintessential">Quintessential</option>
                <option value="New Rocker">New Rocker</option>
                <option value="Merienda">Merienda</option>
                <option value="Lugrasimo">Lugrasimo</option>
                <option value="Jim Nightshade">Jim Nightshade</option>
                <option value="Grenze Gotisch">Grenze Gotisch</option>
                <option value="Felipa">Felipa</option>
                <option value="Beth Ellen">Beth Ellen</option>
              </optgroup>
              <optgroup label="Dyslexia friendly fonts">
                <option value="Lexend">Lexend</option>
                <option value="Comic Sans MS">Comic Sans MS</option>
              </optgroup>
            </select>
            <label class="font-size-scale-input-label no-select">Font size scale:</label>
            <input class="font-size-scale-input no-select" type="number" id="font-size-scale-input" min="0.5" max="5.5" value="1" step="0.01" onmousewheel="handleFontSizeMouseWheel()" oninput="handleFontSizeChange(this.value)" onchange="handleFontSizeChange(this.value)">
          </div>
          <div class="preview-text no-select" id="font-preview">
            <div class="title-container">
              <h1 class="main_title no-select">Story Name</h1>
              <h2 class="main_subtitle no-select">Story Timeline</h2>
            </div>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed nisl ut mi volutpat faucibus vel ullamcorper ipsum. Ut pharetra lorem urna, a lacinia risus mollis auctor. Vivamus non ex quam. Aenean mattis eget tortor nec tincidunt. Fusce et pharetra eros, a commodo nunc. Maecenas aliquet gravida lectus nec pellentesque.
          </div>

          <!-- Basic settings -->
          <div class="basic-settings">
            <div class="settings-form">
              <div class="settings-row">
                <label class="no-select" for="title">Title/Universe</label>
                <div class="settings-input-container">
                  <input type="text" id="title" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">The main title of your story or the name of the universe it takes place in</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="author">Author Name</label>
                <div class="settings-input-container">
                  <input type="text" id="author" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Your name or the name of the story's author</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="description">Description</label>
                <div class="settings-input-container">
                  <input type="text" id="description" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">A brief description of your story timeline</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="start">Starting year</label>
                <div class="settings-input-container">
                  <input type="number" id="start" min="-99999999" max="9999999" onmousewheel="return true"; value="0" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">The year your timeline begins (can be negative for BC dates)</div>
                </div>
              </div>
              
              <div class="settings-row">
                <label class="no-select" for="granularity">Granularity</label>
                <div class="settings-input-container">
                  <input type="number" id="granularity" min="1" max="30" value="4" onmousewheel="return true"; class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">How detailed your timeline should be (1-30, where 30 is most detailed)<br />Default is 4, for the four seasons</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="pixels-per-subtick">Tick width</label>
                <div class="settings-input-container">
                  <input type="number" id="pixels-per-subtick" min="1" max="30" value="30" onmousewheel="return true"; class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">How wide each tick should be</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-timeline-css">Use Timeline CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-timeline-css" class="settings-input" onclick="toggleTimelineCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for the timeline</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-css">Timeline CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for the timeline container and elements</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-main-css">Use Main CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-main-css" class="settings-input" onclick="toggleMainCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for the main application</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-main-css">Main CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-main-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-main-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for the main application body and elements</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-items-css">Use Items CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-items-css" class="settings-input" onclick="toggleItemsCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for timeline items</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-items-css">Items CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-items-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-items-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for timeline items and markers</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="show-guides">Show guides</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="show-guides" class="settings-input" onclick="toggleGuides(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Show guides for the timeline</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-custom-scaling">Use Custom Scaling</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-custom-scaling" class="settings-input" onclick="toggleCustomScaling(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Enable custom window scaling</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-scale">Custom Scale</label>
                <div class="settings-input-container">
                  <input type="number" id="custom-scale" class="settings-input" min="0.5" max="2.0" step="0.1" value="1.0" onchange="updateCustomScale(this.value)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Set the window scale factor (0.5x to 2.0x)</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select">Data Management</label>
                <div class="settings-input-container">
                  <button class="settings-button" onclick="exportTimelineData()">Export Timeline Data</button>
                  <button class="settings-button" onclick="importTimelineData()">Import Timeline Data</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Export/Import timeline items and story references</div>
                </div>
              </div>

            </div>
          </div>




          <button class="settings-button save_settings-button no-select" id="btn_SaveSettings">Save and close</button>
        </div>
      </div>
    </div>



    
    <!-- Item Viewer Modal -->
    <div id="item-viewer-modal" class="modal">
      <div class="modal-content fullscreen">
        <button class="close-button" id="item-viewer-close">&times;</button>
        
        <div class="modal-header">
          <h1 id="item-viewer-title">Item Title</h1>
          <div class="date-row">
            <span><span class="label">Year:</span> <span id="item-viewer-year"></span></span>
            <span><span class="label">Subyear:</span> <span id="item-viewer-subtick"></span></span>
          </div>
          <div class="description" id="item-viewer-description"></div>
          <div class="tags-container" id="item-viewer-tags"></div>
        </div>

        <div class="modal-body">
          <div class="content-section">
            <h2>Content</h2>
            <div class="content-text" id="item-viewer-content" onclick="this.classList.toggle('content-text-open')"></div>
          </div>

          <div class="images-section">
            <h2>Images</h2>
            <div class="images-grid" id="item-viewer-pictures">
              <!-- Images will be inserted here -->
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="book-info">
            <div class="book-title" id="item-viewer-book-title"></div>
            <div class="book-details">
              <span><span class="label">Chapter:</span> <span id="item-viewer-chapter"></span></span>
              <span><span class="label">Page:</span> <span id="item-viewer-page"></span></span>
            </div>
          </div>

          <div class="story-references">
            <h3>Story References</h3>
            <div class="story-list" id="item-viewer-stories">
              <!-- Story references will be inserted here -->
            </div>
          </div>
        </div>

        <div class="modal-controls">
          <button class="modal-button edit-button" id="item-viewer-edit">Edit</button>
          <button class="modal-button delete-button" id="item-viewer-delete">Delete</button>
        </div>
      </div>
    </div>
    
    
    
    
    <!-- Item Selector -->
    <div id="item-selector" class="item-selector">
      <button class="item-selector-button" data-type="event">
        <i class="ri-calendar-event-fill"></i>
        Event
      </button>
      <button class="item-selector-button" data-type="period">
        <i class="ri-calendar-2-fill"></i>
        Period
      </button>
      <button class="item-selector-button" data-type="age">
        <i class="ri-hourglass-fill"></i>
        Age
      </button>
      <button class="item-selector-button" data-type="picture">
        <i class="ri-image-fill"></i>
        Picture
      </button>
      <button class="item-selector-button" data-type="note">
        <i class="ri-sticky-note-fill"></i>
        Note
      </button>
      <button class="item-selector-button" data-type="bookmark">
        <i class="ri-bookmark-fill"></i>
        Bookmark
      </button>
    </div>

    <div id="display-container">
      <div id="display-content">
        Hello
      </div>
    </div>

    <div id="jump-to-date-container" class="jump-to-date-container">
      <div id="guides">
        <div id="size_guide">0x0</div>
        <div id="position_guide">0:0</div>
        <div id="scale_guide">1</div>
      </div>
      <input type="number" id="jump-to-date" onmousewheel="" class="jump-to-date-input" min="-99999999" max="99999999" value="0" step="1" onkeydown="if(event.key === 'Enter') jumpToDate()">
      <button id="jump-to-date-button" onclick="jumpToDate()">Jump</button>

      <div class="timeline-info-container">
        <div class="timeline-info-item">
          <div class="timeline-info-item-value" id="timeline-info-now">0 .0</div>
          <div class="timeline-info-item-value" id="timeline-info-hover">0 .0</div>
        </div>
      </div>
    </div>

    <div id="terminal-panel" class="terminal-panel">
        <div class="terminal-header">
            <span>Terminal</span>
            <button id="close-terminal" class="close-terminal">×</button>
        </div>
        <div id="terminal-content" class="terminal-content"></div>
    </div>

    <script src="timeline.js"></script>
    <script src="renderer.js"></script>
    <script type="module">
      import menubar from './menubar.js';

      // Add File menu
      menubar.addMenu('File', [
        { label: 'New Timeline', action: () => window.api.send('new-timeline') },
        { label: 'Import...', action: () => importTimelineData() },
        { label: 'Export...', action: () => exportTimelineData() },
        { separator: true },
        { label: 'Refresh', action: () => refreshAllItems() },
        { separator: true },
        { label: 'Exit', action: () => window.api.send('quit-app') }
      ]);

      // Add Edit menu
      menubar.addMenu('Edit', [
        { label: 'Add Item', action: () => {
          const centerX = document.getElementById('timeline-container').offsetWidth / 2;
          const year = calculateYearFromPosition(centerX);
          const subtick = calculateSubtickFromPosition(centerX);
          openAddItemWindow(year, subtick, timelineState.granularity);
        }},
        { label: 'Settings', action: () => openSettings() }
      ]);

      // Add View menu
      menubar.addMenu('View', [
        { label: 'Show Guides', action: () => toggleGuides(true) },
        { label: 'Hide Guides', action: () => toggleGuides(false) }
      ]);

      // Add Help menu
      menubar.addMenu('Help', [
        { label: 'About', action: () => {
          const version = document.getElementById('version-display').textContent;
          const aboutText = `Story Timeline
Version ${version}

A powerful timeline visualization tool for writers and storytellers, allowing you to create, manage, and visualize complex story timelines with ease.

Developed by WolfyD @WolfPaw Co.
Contact: info@wolfyden.nl

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.`;

          alert(aboutText);
        }}
      ]);
    </script>
  </body>
</html>
