<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Story Timeline</title>
    <link rel="stylesheet" href="main.css" type="text/css" />
    <link rel="stylesheet" href="timeline.css" type="text/css" />
    <link rel="stylesheet" href="modal.css" type="text/css" />
    <link rel="stylesheet" href="menubar.css" type="text/css" />
  </head>
  <body>
    <button class="settings-button open-settings-button no-select" onclick="openSettings()">Settings</button>
    <div id="version-display" class="version-display no-select">v0.1.3</div>
    <div class="title-container">
      <h1 id="main_title" class="main_title no-select">Story Name</h1>
      <h2 id="main_subtitle" class="main_subtitle no-select">Story Timeline</h2>
    </div>

    <!-- Settings -->
    <div class="settings_container">
      <div class="settings_div"> <button class="settings-button close_settings-button no-select" onclick="closeSettings()">X</button>
        <h1 class="no-select">Settings</h1>
        <div class="font-selector">
          <label for="font-select no-select">Default Font:</label>
          <div class="font-selector-container">
            <select id="font-select" onmousewheel="handleFontMouseWheel()" onchange="handleFontChange(this.value)">
              <optgroup label="Default fonts">
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Arial">Arial</option>
                <option value="Courier New">Courier New</option>
                <option value="Verdana">Verdana</option>
                <option value="Tahoma">Tahoma</option>
                <option value="Trebuchet MS">Trebuchet MS</option>
                <option value="Palatino">Palatino</option>
              </optgroup>
              <optgroup label="Custom fonts">
                <option value="Homemade Apple">Homemade Apple</option>
                <option value="Delicious Handrawn">Delicious Handrawn</option>
                <option value="Borel">Borel</option>
                <option value="Quintessential">Quintessential</option>
                <option value="New Rocker">New Rocker</option>
                <option value="Merienda">Merienda</option>
                <option value="Lugrasimo">Lugrasimo</option>
                <option value="Jim Nightshade">Jim Nightshade</option>
                <option value="Grenze Gotisch">Grenze Gotisch</option>
                <option value="Felipa">Felipa</option>
                <option value="Beth Ellen">Beth Ellen</option>
              </optgroup>
              <optgroup label="Dyslexia friendly fonts">
                <option value="Lexend">Lexend</option>
                <option value="Comic Sans MS">Comic Sans MS</option>
              </optgroup>
            </select>
            <label class="font-size-scale-input-label no-select">Font size scale:</label>
            <input class="font-size-scale-input no-select" type="number" id="font-size-scale-input" min="0.5" max="5.5" value="1" step="0.01" onmousewheel="handleFontSizeMouseWheel()" oninput="handleFontSizeChange(this.value)" onchange="handleFontSizeChange(this.value)">
          </div>
          <div class="preview-text no-select" id="font-preview">
            <div class="title-container">
              <h1 class="main_title no-select">Story Name</h1>
              <h2 class="main_subtitle no-select">Story Timeline</h2>
            </div>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed nisl ut mi volutpat faucibus vel ullamcorper ipsum. Ut pharetra lorem urna, a lacinia risus mollis auctor. Vivamus non ex quam. Aenean mattis eget tortor nec tincidunt. Fusce et pharetra eros, a commodo nunc. Maecenas aliquet gravida lectus nec pellentesque.
          </div>

          <!-- Basic settings -->
          <div class="basic-settings">
            <div class="settings-form">
              <div class="settings-row">
                <label class="no-select" for="title">Title/Universe</label>
                <div class="settings-input-container">
                  <input type="text" id="title" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">The main title of your story or the name of the universe it takes place in</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="author">Author Name</label>
                <div class="settings-input-container">
                  <input type="text" id="author" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Your name or the name of the story's author</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="description">Description</label>
                <div class="settings-input-container">
                  <input type="text" id="description" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">A brief description of your story timeline</div>
                </div>
              </div>
              <div class="settings-row">
                <label class="no-select" for="start">Starting year</label>
                <div class="settings-input-container">
                  <input type="number" id="start" min="-99999999" max="9999999" onmousewheel="return true"; value="0" class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">The year your timeline begins (can be negative for BC dates)</div>
                </div>
              </div>
              
              <div class="settings-row">
                <label class="no-select" for="granularity">Granularity</label>
                <div class="settings-input-container">
                  <input type="number" id="granularity" min="1" max="30" value="4" onmousewheel="return true"; class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">How detailed your timeline should be (1-30, where 30 is most detailed)<br />Default is 4, for the four seasons</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="pixels-per-subtick">Tick width</label>
                <div class="settings-input-container">
                  <input type="number" id="pixels-per-subtick" min="1" max="30" value="30" onmousewheel="return true"; class="settings-input">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">How wide each tick should be</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-timeline-css">Use Timeline CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-timeline-css" class="settings-input" onclick="toggleTimelineCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for the timeline</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-css">Timeline CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for the timeline container and elements</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-main-css">Use Main CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-main-css" class="settings-input" onclick="toggleMainCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for the main application</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-main-css">Main CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-main-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-main-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for the main application body and elements</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-items-css">Use Items CSS</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-items-css" class="settings-input" onclick="toggleItemsCSS(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Use custom CSS for timeline items</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-items-css">Items CSS</label>
                <div class="settings-input-container">
                  <textarea readonly id="custom-items-css" class="settings-input custom-css" spellcheck="false" onkeydown="handleCodeEditorKeydown(event)"></textarea>
                  <button class="settings-button reset-template-button" onclick="resetToTemplate('custom-items-css')">Reset to Template</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Custom CSS for timeline items and markers</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="show-guides">Show guides</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="show-guides" class="settings-input" onclick="toggleGuides(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Show guides for the timeline</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="use-custom-scaling">Use Custom Scaling</label>
                <div class="settings-input-container">
                  <input type="checkbox" id="use-custom-scaling" class="settings-input" onclick="toggleCustomScaling(this.checked)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Enable custom window scaling</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select" for="custom-scale">Custom Scale</label>
                <div class="settings-input-container">
                  <input type="number" id="custom-scale" class="settings-input" min="0.5" max="2.0" step="0.1" value="1.0" onchange="updateCustomScale(this.value)">
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Set the window scale factor (0.5x to 2.0x)</div>
                </div>
              </div>

              <div class="settings-row">
                <label class="no-select">Data Management</label>
                <div class="settings-input-container">
                  <button class="settings-button" onclick="exportTimelineData()">Export Timeline Data</button>
                  <button class="settings-button" onclick="importTimelineData()">Import Timeline Data</button>
                  <span class="info-icon">?</span>
                  <div class="info-bubble no-select">Export/Import timeline items and story references</div>
                </div>
              </div>

            </div>
          </div>




          <button class="settings-button save_settings-button no-select" id="btn_SaveSettings">Save and close</button>
        </div>
      </div>
    </div>



    
    <!-- Timeline -->
    <div class="timeline_container" id="timeline-container">
      <div id="timeline"></div>
      <div id="arrow"></div><div id="now-marker">Now</div>
      <div id="center-line"></div>
      <div id="h-rule"></div>
      <div id="timeline-hover-marker"></div>
      <div id="timeline-hover-marker-stick"></div>
    </div>

    <!-- jump to date -->
    <div class="jump-to-date-container">
      <input type="number" id="jump-to-date" onmousewheel="" class="jump-to-date-input" min="-99999999" max="99999999" value="0" step="1">
      <button id="jump-to-date-button" onclick="jumpToDate()">Jump</button>
    </div>
    
    <div class="timeline-info-container">
      <div class="timeline-info-item">
        <div class="timeline-info-item-value" id="timeline-info-now">0 .0</div>
        <div class="timeline-info-item-value" id="timeline-info-hover">0 .0</div>
      </div>
    </div>
    
    
    
    
    
    
    
    <div id="item-viewer-modal" class="modal">
      <div class="modal-content fullscreen">
        <button class="close-button" id="item-viewer-close">&times;</button>
        
        <div class="modal-header">
          <h1 id="item-viewer-title">Item Title</h1>
          <div class="date-row">
            <span><span class="label">Year:</span> <span id="item-viewer-year"></span></span>
            <span><span class="label">Subyear:</span> <span id="item-viewer-subtick"></span></span>
          </div>
          <div class="description" id="item-viewer-description"></div>
          <div class="tags-container" id="item-viewer-tags"></div>
        </div>

        <div class="modal-body">
          <div class="content-section">
            <h2>Content</h2>
            <div class="content-text" id="item-viewer-content" onclick="this.classList.toggle('content-text-open')"></div>
          </div>

          <div class="images-section">
            <h2>Images</h2>
            <div class="images-grid" id="item-viewer-pictures">
              <!-- Images will be inserted here -->
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="book-info">
            <div class="book-title" id="item-viewer-book-title"></div>
            <div class="book-details">
              <span><span class="label">Chapter:</span> <span id="item-viewer-chapter"></span></span>
              <span><span class="label">Page:</span> <span id="item-viewer-page"></span></span>
            </div>
          </div>

          <div class="story-references">
            <h3>Story References</h3>
            <div class="story-list" id="item-viewer-stories">
              <!-- Story references will be inserted here -->
            </div>
          </div>
        </div>

        <div class="modal-controls">
          <button class="modal-button edit-button" id="item-viewer-edit">Edit</button>
          <button class="modal-button delete-button" id="item-viewer-delete">Delete</button>
        </div>
      </div>
    </div>
    
    
    
    
    
    
    
    
    <script src="timeline.js"></script>
    <script src="renderer.js"></script>
    <script type="module">
      import menubar from './menubar.js';

      // Add File menu
      menubar.addMenu('File', [
        { label: 'New Timeline', action: () => console.log('New Timeline') },
        { label: 'Import...', action: () => importTimelineData() },
        { label: 'Export...', action: () => exportTimelineData() },
        { separator: true },
        { label: 'Refresh', action: () => refreshAllItems() },
        { separator: true },
        { label: 'Exit', action: () => window.api.send('quit-app') }
      ]);

      // Add Edit menu
      menubar.addMenu('Edit', [
        { label: 'Add Item', action: () => openAddItemWindow(0, 0, 4) },
        { label: 'Settings', action: () => openSettings() }
      ]);

      // Add View menu
      menubar.addMenu('View', [
        { label: 'Show Guides', action: () => toggleGuides(true) },
        { label: 'Hide Guides', action: () => toggleGuides(false) }
      ]);

      // Add Help menu
      menubar.addMenu('Help', [
        { label: 'About', action: () => alert('Story Timeline v' + document.getElementById('version-display').textContent) }
      ]);
    </script>
    <div id="guides">
      <div id="size_guide">0x0</div> <div id="position_guide">0:0</div> <div id="scale_guide">1</div>
    </div>

    <!-- Item Selector -->
    <div id="item-selector" class="item-selector">
      <button class="item-selector-button" data-type="event">
        <i class="fas fa-calendar-day"></i>
        Event
      </button>
      <button class="item-selector-button" data-type="period">
        <i class="fas fa-calendar-week"></i>
        Period
      </button>
      <button class="item-selector-button" data-type="age">
        <i class="fas fa-hourglass-half"></i>
        Age
      </button>
      <button class="item-selector-button" data-type="picture">
        <i class="fas fa-image"></i>
        Picture
      </button>
      <button class="item-selector-button" data-type="note">
        <i class="fas fa-sticky-note"></i>
        Note
      </button>
      <button class="item-selector-button" data-type="bookmark">
        <i class="fas fa-bookmark"></i>
        Bookmark
      </button>
    </div>
  </body>
</html>
